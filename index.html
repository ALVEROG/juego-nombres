<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Juego de Nombres</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;text-align:center;padding:30px;}
    h1{font-size:34px;margin-bottom:6px;}
    p{color:#444}
    input{padding:10px;font-size:16px;width:320px;max-width:80%}
    button{padding:10px 18px;font-size:16px;margin-left:8px}
    #resultado{margin-top:20px;font-size:20px;color:#0b5;font-weight:700}
    #error{margin-top:14px;color:#c33}
    footer{margin-top:40px;color:#888;font-size:13px}
  </style>
</head>
<body>
  <h1>Juego de Nombres</h1>
  <p>Escribe tu nombre para participar:</p>

  <input id="miNombre" placeholder="Tu nombre aqu√≠" autocomplete="off" />
  <button id="btnSorteo">¬°Dame mi nombre!</button>
  <button id="btnTest">Comprobar JS</button>

  <div id="resultado" aria-live="polite"></div>
  <div id="error" aria-live="polite"></div>

  <footer>
    Si no funciona, abre la consola (F12) y copia el error aqu√≠ en el chat.
  </footer>

<script>
/* -------------------------
  Lista de participantes
  Edita aqu√≠ los nombres (m√°x 20)
---------------------------- */
const nombresOriginal = [
  "Adrian","Gianella","Gisella","Maricrys","Alveiro","Javier",
  "Mafe","Carol","Alejo","Norys","Ligia","Merlyn",
  "Diana","Camilo"
];

// normaliza: conserva una versi√≥n "display" y una versi√≥n "llave" (lowercase trimmed)
const nombres = nombresOriginal.map(n => ({ key: n.trim().toLowerCase(), display: n.trim() }));

// estado persistente: objeto { jugadorKey: asignadoDisplay }
let asignaciones = {};
try {
  const raw = localStorage.getItem('asignaciones');
  if(raw) asignaciones = JSON.parse(raw);
} catch(e){
  console.error('Error leyendo localStorage:', e);
  asignaciones = {};
}

// helpers
function limpiarTexto(s){ return String(s||'').trim(); }
function keyOf(name){ return limpiarTexto(name).toLowerCase(); }

// bot√≥n de prueba
document.getElementById('btnTest').addEventListener('click', function(){
  console.log('Prueba JS: nombres cargados =', nombres.map(x=>x.display));
  alert('JS ejecut√°ndose. Si esto aparece, el script corre correctamente.');
});

// funci√≥n principal
document.getElementById('btnSorteo').addEventListener('click', sortear);

function mostrarMensaje(texto, esError){
  const r = document.getElementById('resultado');
  const e = document.getElementById('error');
  if(esError){
    e.textContent = texto;
    r.textContent = '';
  } else {
    r.textContent = texto;
    e.textContent = '';
  }
}

function sortear(){
  try{
    mostrarMensaje('', false); // limpiar
    const rawNombre = document.getElementById('miNombre').value;
    const nombre = limpiarTexto(rawNombre);
    if(!nombre){
      mostrarMensaje('‚ö†Ô∏è Escribe tu nombre primero.', true);
      return;
    }

    const miKey = keyOf(nombre);

    // si ya tengo asignaci√≥n registrada para este jugador (key exacta)
    if(asignaciones[miKey]){
      mostrarMensaje('üéâ Ya jugaste antes. Te sali√≥: ' + asignaciones[miKey], false);
      console.log('Jugador ya ten√≠a asignaci√≥n:', miKey, asignaciones[miKey]);
      return;
    }

    // construir lista de posibles: nombres que no sean el propio y no hayan sido usados
    const usados = Object.values(asignaciones).map(v => v.toLowerCase());
    const posibles = nombres
      .filter(n => n.key !== miKey)          // no mi propio nombre
      .filter(n => !usados.includes(n.display.toLowerCase())); // no usados

    console.log('miKey=', miKey, 'usados=', usados, 'posibles=', posibles.map(p=>p.display));

    if(posibles.length === 0){
      mostrarMensaje('üòÆ Ya no quedan nombres disponibles.', true);
      return;
    }

    // elegir aleatorio
    const elegido = posibles[Math.floor(Math.random() * posibles.length)];

    // guardar asignaci√≥n: clave = jugadorKey, valor = elegido.display
    asignaciones[miKey] = elegido.display;
    try {
      localStorage.setItem('asignaciones', JSON.stringify(asignaciones));
    } catch(saveErr){
      console.warn('No se pudo persistir en localStorage:', saveErr);
    }

    mostrarMensaje('üéÅ Te toc√≥: ' + elegido.display, false);
    console.log('Asignado:', miKey, '‚Üí', elegido.display);
  } catch(err){
    console.error('Error en sortear():', err);
    mostrarMensaje('‚ùå Ocurri√≥ un error. Abre la consola y copia el mensaje aqu√≠.', true);
  }
}
</script>
</body>
</html>


